<div
  class="flex flex-col bg-white rounded-2xl border border-indigo-50 shadow-[0_2px_12px_rgba(63,81,181,0.06)] overflow-hidden transition-all duration-200 hover:shadow-[0_8px_28px_rgba(63,81,181,0.14)] hover:-translate-y-0.5"
>
  <!-- Cover Image -->
  <div class="w-full aspect-square bg-indigo-50 overflow-hidden relative group">
    @if (recipe.images && recipe.images.length > 0) {
      <img
        [src]="recipe.images[currentImageIndex].imageUrl"
        [alt]="recipe.productName"
        class="w-full h-full object-cover"
      />

      @if (recipe.images.length > 1) {
        <!-- Flechas de navegaci√≥n -->
        <button
          type="button"
          (click)="$event.stopPropagation(); prevImage(recipe.images.length)"
          class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/70 hover:bg-white text-indigo-700 w-8 h-8 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-10"
        >
          <mat-icon class="text-lg w-[18px] h-[18px]">chevron_left</mat-icon>
        </button>

        <button
          type="button"
          (click)="$event.stopPropagation(); nextImage(recipe.images.length)"
          class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/70 hover:bg-white text-indigo-700 w-8 h-8 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-10"
        >
          <mat-icon class="text-lg w-[18px] h-[18px]">chevron_right</mat-icon>
        </button>

        <!-- Paginador de puntos -->
        <div
          class="absolute bottom-2 left-0 right-0 flex justify-center gap-1.5 z-10 w-full px-4"
        >
          @for (img of recipe.images; track img.publicId; let idx = $index) {
            <span
              class="block w-2 h-2 rounded-full transition-all bg-white"
              [class.opacity-40]="currentImageIndex !== idx"
              [class.scale-125]="currentImageIndex === idx"
            ></span>
          }
        </div>
      }
    } @else {
      <div
        class="w-full h-full flex flex-col items-center justify-center text-indigo-200 bg-indigo-50"
      >
        <mat-icon class="text-5xl w-12 h-12 opacity-50 mb-2"
          >restaurant</mat-icon
        >
        <span class="text-sm font-medium">Sin imagen</span>
      </div>
    }
  </div>

  <!-- Card header -->
  <div
    class="flex justify-between items-start px-5 pt-[18px] pb-4 bg-gradient-to-br from-[#3949ab] to-[#5c6bc0] text-white"
  >
    <div class="flex items-start gap-3">
      <span class="text-[2rem] leading-none mt-0.5">üçΩÔ∏è</span>
      <div>
        <h3 class="text-[1.05rem] font-bold text-white m-0 mb-1.5">
          {{ recipe.productName }}
        </h3>
        <span
          class="inline-flex items-center gap-1 text-[0.78rem] font-semibold px-2.5 py-1 rounded-full text-white"
          [ngClass]="{
            'bg-red-600/35':
              getPortionColor(+(recipe.availablePortions ?? 0)) === 'danger',
            'bg-orange-500/35':
              getPortionColor(+(recipe.availablePortions ?? 0)) === 'warning',
            'bg-green-600/35':
              getPortionColor(+(recipe.availablePortions ?? 0)) === 'success'
          }"
        >
          <mat-icon class="text-[0.85rem] w-[0.85rem] h-[0.85rem]"
            >inventory_2</mat-icon
          >
          {{ recipe.availablePortions ?? 0 }} porciones disponibles
        </span>
      </div>
    </div>
    <div
      class="flex gap-1 [&>button]:!text-white/[0.85] hover:[&>button]:!text-white hover:[&>button]:!bg-white/15"
    >
      @if (canEdit) {
        <button
          mat-icon-button
          matTooltip="Editar receta"
          (click)="edit.emit(recipe)"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button
          mat-icon-button
          matTooltip="Eliminar receta"
          (click)="delete.emit(recipe)"
        >
          <mat-icon>delete_outline</mat-icon>
        </button>
      }
    </div>
  </div>

  <!-- Ingredients table -->
  <div class="px-5">
    <div
      class="grid grid-cols-[1.4fr_0.7fr_0.5fr_0.7fr] md:grid-cols-[1.8fr_0.8fr_0.6fr_0.8fr] gap-2 pt-2.5 pb-1.5 border-b-2 border-indigo-50 text-[0.75rem] font-bold text-[#7986cb] uppercase tracking-[0.5px]"
    >
      <span>Ingrediente</span>
      <span>Cantidad</span>
      <span>Unidad</span>
      <span>Costo</span>
    </div>
    @for (ing of recipe.ingredients; track ing.ingredientProductId) {
      <div
        class="grid grid-cols-[1.4fr_0.7fr_0.5fr_0.7fr] md:grid-cols-[1.8fr_0.8fr_0.6fr_0.8fr] gap-2 py-2 border-b border-[#f0f2ff] last:border-0 text-[0.8rem] md:text-[0.875rem] items-center transition-colors"
      >
        <span class="text-[#283593] font-medium">{{
          ing.ingredientProductName
        }}</span>
        <span class="text-[#3949ab] font-semibold">{{
          ing.quantity | number: '1.0-3'
        }}</span>
        <span class="text-[#7986cb] text-[0.8rem]">{{ ing.unit }}</span>
        <span class="text-[#43a047] font-semibold text-right"
          >${{ ing.totalCost | number: '1.0-0' }}</span
        >
      </div>
    }
  </div>

  <!-- Card footer: costo total -->
  <div
    class="flex justify-between items-center px-5 py-3.5 bg-[#f5f7ff] border-t border-[#e8eaf6] mt-1 flex-1"
  >
    <div class="flex flex-col">
      <span
        class="text-[0.75rem] text-[#9fa8da] font-semibold uppercase tracking-[0.5px]"
        >Costo total de la receta</span
      >
      <span
        class="text-[1.25rem] font-extrabold"
        [ngClass]="{
          'text-[#43a047]': getCostClass(recipe.totalRecipeCost) === 'low-cost',
          'text-[#fb8c00]': getCostClass(recipe.totalRecipeCost) === 'mid-cost',
          'text-[#e53935]': getCostClass(recipe.totalRecipeCost) === 'high-cost'
        }"
      >
        ${{ recipe.totalRecipeCost | number: '1.0-0' }}
      </span>
    </div>
    <div
      class="flex items-center gap-1 bg-[#e8eaf6] text-[#3949ab] rounded-[20px] px-3 py-1 text-[0.8rem] font-semibold [&>mat-icon]:text-[0.9rem] [&>mat-icon]:w-[0.9rem] [&>mat-icon]:h-[0.9rem]"
    >
      <mat-icon>egg_alt</mat-icon>
      {{ recipe.ingredients.length }} ingrediente{{
        recipe.ingredients.length !== 1 ? 's' : ''
      }}
    </div>
  </div>
</div>
